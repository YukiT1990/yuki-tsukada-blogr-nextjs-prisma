{"ast":null,"code":"var _jsxFileName = \"/Users/yuki.t/Desktop/NextJSPractice/blogr-nextjs-prisma/pages/p/[id].tsx\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport Layout from \"../../components/Layout\";\nimport Router from \"next/router\";\nimport { useSession } from \"next-auth/client\";\nimport prisma from \"../../lib/prisma\";\nexport const getServerSideProps = async ({\n  params\n}) => {\n  const postR = await prisma.post.findUnique({\n    where: {\n      id: Number(params === null || params === void 0 ? void 0 : params.id) || -1\n    },\n    include: {\n      author: {\n        select: {\n          name: true,\n          email: true\n        }\n      }\n    }\n  });\n  const post = JSON.parse(JSON.stringify(postR));\n  return {\n    props: post\n  };\n};\n\nasync function publishPost(id) {\n  await fetch(`/api/publish/${id}`, {\n    method: \"PUT\"\n  });\n  await Router.push(\"/\");\n}\n\nasync function deletePost(id) {\n  await fetch(`/api/post/${id}`, {\n    method: \"DELETE\"\n  });\n  Router.push(\"/\");\n}\n\nasync function editPost(id) {\n  Router.push(`/edit/${id}`);\n}\n\nconst Post = props => {\n  var _session$user, _props$author, _props$author2;\n\n  const [session, loading] = useSession();\n\n  if (loading) {\n    return __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 12\n      }\n    }, \"Authenticating ...\");\n  }\n\n  const userHasValidSession = Boolean(session);\n  const postBelongsToUser = (session === null || session === void 0 ? void 0 : (_session$user = session.user) === null || _session$user === void 0 ? void 0 : _session$user.email) === ((_props$author = props.author) === null || _props$author === void 0 ? void 0 : _props$author.email);\n  let title = props.title;\n\n  if (!props.published) {\n    title = `${title} (Draft)`;\n  }\n\n  return __jsx(Layout, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"jsx-1198372872\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"jsx-1198372872\" + \" \" + \"postContents\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 9\n    }\n  }, __jsx(\"h2\", {\n    className: \"jsx-1198372872\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 11\n    }\n  }, title), __jsx(\"p\", {\n    className: \"jsx-1198372872\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 11\n    }\n  }, \"By \", (props === null || props === void 0 ? void 0 : (_props$author2 = props.author) === null || _props$author2 === void 0 ? void 0 : _props$author2.name) || \"Unknown author\"), __jsx(ReactMarkdown, {\n    source: props.content,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 11\n    }\n  }), __jsx(\"small\", {\n    className: \"jsx-1198372872\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 11\n    }\n  }, \"Created at: \", props.createdAt.substring(0, 10), \" \", props.createdAt.substring(11, 19), \" \"), __jsx(\"br\", {\n    className: \"jsx-1198372872\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 11\n    }\n  }), __jsx(\"small\", {\n    className: \"jsx-1198372872\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 11\n    }\n  }, \"Updated at: \", props.updatedAt.substring(0, 10), \" \", props.updatedAt.substring(11, 19)), __jsx(\"br\", {\n    className: \"jsx-1198372872\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 11\n    }\n  })), !props.published && userHasValidSession && postBelongsToUser && __jsx(\"button\", {\n    onClick: () => publishPost(props.id),\n    className: \"jsx-1198372872\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 11\n    }\n  }, \"Publish\"), userHasValidSession && postBelongsToUser && __jsx(React.Fragment, null, __jsx(\"button\", {\n    onClick: () => editPost(props.id),\n    className: \"jsx-1198372872\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 13\n    }\n  }, \"Edit\"), __jsx(\"button\", {\n    onClick: () => deletePost(props.id),\n    className: \"jsx-1198372872\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }\n  }, \"Delete\"))), __jsx(_JSXStyle, {\n    id: \"1198372872\",\n    __self: this\n  }, \".page.jsx-1198372872{background:rgba(0,255,0,0.05);padding:2rem;}.actions.jsx-1198372872{margin-top:2rem;}.postContents.jsx-1198372872{background:white;}button.jsx-1198372872{background:#00e600;border:1px solid black;border-radius:0.125rem;padding:1rem 2rem;}button.jsx-1198372872+button.jsx-1198372872{margin-left:1rem;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy95dWtpLnQvRGVza3RvcC9OZXh0SlNQcmFjdGljZS9ibG9nci1uZXh0anMtcHJpc21hL3BhZ2VzL3AvW2lkXS50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBcUZrQixBQUc0QyxBQUtqQixBQUlDLEFBSUUsQUFRRixnQkFmbkIsQ0FJQSxBQVlBLEVBUHlCLFdBZFYsWUFlVSxDQWR6QixzQkFlb0Isa0JBQ3BCIiwiZmlsZSI6Ii9Vc2Vycy95dWtpLnQvRGVza3RvcC9OZXh0SlNQcmFjdGljZS9ibG9nci1uZXh0anMtcHJpc21hL3BhZ2VzL3AvW2lkXS50c3giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBHZXRTZXJ2ZXJTaWRlUHJvcHMgfSBmcm9tIFwibmV4dFwiO1xuaW1wb3J0IFJlYWN0TWFya2Rvd24gZnJvbSBcInJlYWN0LW1hcmtkb3duXCI7XG5pbXBvcnQgTGF5b3V0IGZyb20gXCIuLi8uLi9jb21wb25lbnRzL0xheW91dFwiO1xuaW1wb3J0IFJvdXRlciBmcm9tIFwibmV4dC9yb3V0ZXJcIjtcbmltcG9ydCB7IFBvc3RQcm9wcyB9IGZyb20gXCIuLi8uLi9jb21wb25lbnRzL1Bvc3RcIjtcbmltcG9ydCB7IHVzZVNlc3Npb24gfSBmcm9tIFwibmV4dC1hdXRoL2NsaWVudFwiO1xuaW1wb3J0IHByaXNtYSBmcm9tIFwiLi4vLi4vbGliL3ByaXNtYVwiO1xuaW1wb3J0IExpbmsgZnJvbSBcIm5leHQvbGlua1wiO1xuXG5leHBvcnQgY29uc3QgZ2V0U2VydmVyU2lkZVByb3BzOiBHZXRTZXJ2ZXJTaWRlUHJvcHMgPSBhc3luYyAoeyBwYXJhbXMgfSkgPT4ge1xuICBjb25zdCBwb3N0UiA9IGF3YWl0IHByaXNtYS5wb3N0LmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogTnVtYmVyKHBhcmFtcz8uaWQpIHx8IC0xLFxuICAgIH0sXG4gICAgaW5jbHVkZToge1xuICAgICAgYXV0aG9yOiB7XG4gICAgICAgIHNlbGVjdDogeyBuYW1lOiB0cnVlLCBlbWFpbDogdHJ1ZSB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcbiAgY29uc3QgcG9zdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocG9zdFIpKTtcbiAgcmV0dXJuIHtcbiAgICBwcm9wczogcG9zdCxcbiAgfTtcbn07XG5cbmFzeW5jIGZ1bmN0aW9uIHB1Ymxpc2hQb3N0KGlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgYXdhaXQgZmV0Y2goYC9hcGkvcHVibGlzaC8ke2lkfWAsIHtcbiAgICBtZXRob2Q6IFwiUFVUXCIsXG4gIH0pO1xuICBhd2FpdCBSb3V0ZXIucHVzaChcIi9cIik7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVBvc3QoaWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCBmZXRjaChgL2FwaS9wb3N0LyR7aWR9YCwge1xuICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgfSk7XG4gIFJvdXRlci5wdXNoKFwiL1wiKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZWRpdFBvc3QoaWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICBSb3V0ZXIucHVzaChgL2VkaXQvJHtpZH1gKTtcbn1cblxuY29uc3QgUG9zdDogUmVhY3QuRkM8UG9zdFByb3BzPiA9IChwcm9wcykgPT4ge1xuICBjb25zdCBbc2Vzc2lvbiwgbG9hZGluZ10gPSB1c2VTZXNzaW9uKCk7XG4gIGlmIChsb2FkaW5nKSB7XG4gICAgcmV0dXJuIDxkaXY+QXV0aGVudGljYXRpbmcgLi4uPC9kaXY+O1xuICB9XG4gIGNvbnN0IHVzZXJIYXNWYWxpZFNlc3Npb24gPSBCb29sZWFuKHNlc3Npb24pO1xuICBjb25zdCBwb3N0QmVsb25nc1RvVXNlciA9IHNlc3Npb24/LnVzZXI/LmVtYWlsID09PSBwcm9wcy5hdXRob3I/LmVtYWlsO1xuICBsZXQgdGl0bGUgPSBwcm9wcy50aXRsZTtcbiAgaWYgKCFwcm9wcy5wdWJsaXNoZWQpIHtcbiAgICB0aXRsZSA9IGAke3RpdGxlfSAoRHJhZnQpYDtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPExheW91dD5cbiAgICAgIDxkaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicG9zdENvbnRlbnRzXCI+XG4gICAgICAgICAgPGgyPnt0aXRsZX08L2gyPlxuICAgICAgICAgIDxwPkJ5IHtwcm9wcz8uYXV0aG9yPy5uYW1lIHx8IFwiVW5rbm93biBhdXRob3JcIn08L3A+XG4gICAgICAgICAgPFJlYWN0TWFya2Rvd24gc291cmNlPXtwcm9wcy5jb250ZW50fSAvPlxuICAgICAgICAgIDxzbWFsbD5cbiAgICAgICAgICAgIENyZWF0ZWQgYXQ6IHtwcm9wcy5jcmVhdGVkQXQuc3Vic3RyaW5nKDAsIDEwKX17XCIgXCJ9XG4gICAgICAgICAgICB7cHJvcHMuY3JlYXRlZEF0LnN1YnN0cmluZygxMSwgMTkpfXtcIiBcIn1cbiAgICAgICAgICA8L3NtYWxsPlxuICAgICAgICAgIDxiciAvPlxuICAgICAgICAgIDxzbWFsbD5cbiAgICAgICAgICAgIFVwZGF0ZWQgYXQ6IHtwcm9wcy51cGRhdGVkQXQuc3Vic3RyaW5nKDAsIDEwKX17XCIgXCJ9XG4gICAgICAgICAgICB7cHJvcHMudXBkYXRlZEF0LnN1YnN0cmluZygxMSwgMTkpfVxuICAgICAgICAgIDwvc21hbGw+XG4gICAgICAgICAgPGJyIC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICB7IXByb3BzLnB1Ymxpc2hlZCAmJiB1c2VySGFzVmFsaWRTZXNzaW9uICYmIHBvc3RCZWxvbmdzVG9Vc2VyICYmIChcbiAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHB1Ymxpc2hQb3N0KHByb3BzLmlkKX0+UHVibGlzaDwvYnV0dG9uPlxuICAgICAgICApfVxuICAgICAgICB7dXNlckhhc1ZhbGlkU2Vzc2lvbiAmJiBwb3N0QmVsb25nc1RvVXNlciAmJiAoXG4gICAgICAgICAgPD5cbiAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17KCkgPT4gZWRpdFBvc3QocHJvcHMuaWQpfT5FZGl0PC9idXR0b24+XG4gICAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IGRlbGV0ZVBvc3QocHJvcHMuaWQpfT5EZWxldGU8L2J1dHRvbj5cbiAgICAgICAgICA8Lz5cbiAgICAgICAgKX1cbiAgICAgIDwvZGl2PlxuICAgICAgPHN0eWxlIGpzeD57YFxuICAgICAgICAucGFnZSB7XG4gICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAyNTUsIDAsIDAuMDUpO1xuICAgICAgICAgIHBhZGRpbmc6IDJyZW07XG4gICAgICAgIH1cblxuICAgICAgICAuYWN0aW9ucyB7XG4gICAgICAgICAgbWFyZ2luLXRvcDogMnJlbTtcbiAgICAgICAgfVxuXG4gICAgICAgIC5wb3N0Q29udGVudHMge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlO1xuICAgICAgICB9XG5cbiAgICAgICAgYnV0dG9uIHtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiAjMDBlNjAwO1xuICAgICAgICAgIC8qIGJvcmRlcjogMDsgKi9cbiAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCBibGFjaztcbiAgICAgICAgICBib3JkZXItcmFkaXVzOiAwLjEyNXJlbTtcbiAgICAgICAgICBwYWRkaW5nOiAxcmVtIDJyZW07XG4gICAgICAgIH1cblxuICAgICAgICBidXR0b24gKyBidXR0b24ge1xuICAgICAgICAgIG1hcmdpbi1sZWZ0OiAxcmVtO1xuICAgICAgICB9XG4gICAgICBgfTwvc3R5bGU+XG4gICAgPC9MYXlvdXQ+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBQb3N0O1xuIl19 */\\n/*@ sourceURL=/Users/yuki.t/Desktop/NextJSPractice/blogr-nextjs-prisma/pages/p/[id].tsx */\"));\n};\n\nexport default Post;","map":{"version":3,"sources":["/Users/yuki.t/Desktop/NextJSPractice/blogr-nextjs-prisma/pages/p/[id].tsx"],"names":["React","ReactMarkdown","Layout","Router","useSession","prisma","getServerSideProps","params","postR","post","findUnique","where","id","Number","include","author","select","name","email","JSON","parse","stringify","props","publishPost","fetch","method","push","deletePost","editPost","Post","session","loading","userHasValidSession","Boolean","postBelongsToUser","user","title","published","content","createdAt","substring","updatedAt"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { GetServerSideProps } from \"next\";\nimport ReactMarkdown from \"react-markdown\";\nimport Layout from \"../../components/Layout\";\nimport Router from \"next/router\";\nimport { PostProps } from \"../../components/Post\";\nimport { useSession } from \"next-auth/client\";\nimport prisma from \"../../lib/prisma\";\nimport Link from \"next/link\";\n\nexport const getServerSideProps: GetServerSideProps = async ({ params }) => {\n  const postR = await prisma.post.findUnique({\n    where: {\n      id: Number(params?.id) || -1,\n    },\n    include: {\n      author: {\n        select: { name: true, email: true },\n      },\n    },\n  });\n  const post = JSON.parse(JSON.stringify(postR));\n  return {\n    props: post,\n  };\n};\n\nasync function publishPost(id: number): Promise<void> {\n  await fetch(`/api/publish/${id}`, {\n    method: \"PUT\",\n  });\n  await Router.push(\"/\");\n}\n\nasync function deletePost(id: number): Promise<void> {\n  await fetch(`/api/post/${id}`, {\n    method: \"DELETE\",\n  });\n  Router.push(\"/\");\n}\n\nasync function editPost(id: number): Promise<void> {\n  Router.push(`/edit/${id}`);\n}\n\nconst Post: React.FC<PostProps> = (props) => {\n  const [session, loading] = useSession();\n  if (loading) {\n    return <div>Authenticating ...</div>;\n  }\n  const userHasValidSession = Boolean(session);\n  const postBelongsToUser = session?.user?.email === props.author?.email;\n  let title = props.title;\n  if (!props.published) {\n    title = `${title} (Draft)`;\n  }\n\n  return (\n    <Layout>\n      <div>\n        <div className=\"postContents\">\n          <h2>{title}</h2>\n          <p>By {props?.author?.name || \"Unknown author\"}</p>\n          <ReactMarkdown source={props.content} />\n          <small>\n            Created at: {props.createdAt.substring(0, 10)}{\" \"}\n            {props.createdAt.substring(11, 19)}{\" \"}\n          </small>\n          <br />\n          <small>\n            Updated at: {props.updatedAt.substring(0, 10)}{\" \"}\n            {props.updatedAt.substring(11, 19)}\n          </small>\n          <br />\n        </div>\n        {!props.published && userHasValidSession && postBelongsToUser && (\n          <button onClick={() => publishPost(props.id)}>Publish</button>\n        )}\n        {userHasValidSession && postBelongsToUser && (\n          <>\n            <button onClick={() => editPost(props.id)}>Edit</button>\n            <button onClick={() => deletePost(props.id)}>Delete</button>\n          </>\n        )}\n      </div>\n      <style jsx>{`\n        .page {\n          background: rgba(0, 255, 0, 0.05);\n          padding: 2rem;\n        }\n\n        .actions {\n          margin-top: 2rem;\n        }\n\n        .postContents {\n          background: white;\n        }\n\n        button {\n          background: #00e600;\n          /* border: 0; */\n          border: 1px solid black;\n          border-radius: 0.125rem;\n          padding: 1rem 2rem;\n        }\n\n        button + button {\n          margin-left: 1rem;\n        }\n      `}</style>\n    </Layout>\n  );\n};\n\nexport default Post;\n"]},"metadata":{},"sourceType":"module"}